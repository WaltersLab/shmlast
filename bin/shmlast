#!/usr/bin/env python3

import argparse

from shmlast.crbl import ReciprocalBestLAST as RBL
from shmlast.util import run_tasks


def rbl_tasks(args):
    if args.output is None:
        args.output = '{q}.x.{d}.rbl.csv'.format(q=args.query, d=args.database)
    rbl = RBL(args.query, args.database, args.output)

    return rbl.tasks()


def main():

    parser = argparse.ArgumentParser()
    subparsers = parser.add_subparsers()

    def add_common_args(p):
        p.add_argument('-q', '--query', required=True)
        p.add_argument('-d', '--database', required=True)
        p.add_argument('-o', '--output')
        p.add_argument('--action', default='run')
        return p

    rbl_parser = add_common_args(subparsers.add_parser('rbl'))
    rbl_parser.set_defaults(func=rbl_tasks)

    args = parser.parse_args()
    tasks = args.func(args)

    run_tasks(tasks, [args.action])   


if __name__ == '__main__':
    main()
